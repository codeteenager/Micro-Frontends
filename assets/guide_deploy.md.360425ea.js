import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.5da65e64.js";const b=JSON.parse('{"title":"部署","description":"","frontmatter":{},"headers":[],"relativePath":"guide/deploy.md","filePath":"guide/deploy.md","lastUpdated":1693905948000}'),p={name:"guide/deploy.md"},o=l(`<h1 id="部署" tabindex="-1">部署 <a class="header-anchor" href="#部署" aria-label="Permalink to &quot;部署&quot;">​</a></h1><p>Nginx部署方案有三种，如果没有特殊需求，个人推荐第三种</p><ol><li>多个应用多个端口，主应用配置多个子应用路径转发到相对应的子应用端口上。</li></ol><ul><li>优点：子应用能单独访问</li><li>缺点：每有新增子应用时，则每次都要新增一个子应用端口和转发</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">http{</span></span>
<span class="line"><span style="color:#E1E4E8;">    # main</span></span>
<span class="line"><span style="color:#E1E4E8;">    server {</span></span>
<span class="line"><span style="color:#E1E4E8;">        listen       </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        location </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            try_files $uri $uri</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">index.html;</span></span>
<span class="line"><span style="color:#E1E4E8;">            root   </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">share</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">main;</span></span>
<span class="line"><span style="color:#E1E4E8;">            index  index.html index.htm;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        location </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">module</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">pms {</span></span>
<span class="line"><span style="color:#E1E4E8;">           try_files $uri $uri</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">index.html;</span></span>
<span class="line"><span style="color:#E1E4E8;">           proxy_pass </span><span style="color:#B392F0;">http</span><span style="color:#E1E4E8;">:</span><span style="color:#6A737D;">//127.0.0.1:8081;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        location </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">module</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">oms {</span></span>
<span class="line"><span style="color:#E1E4E8;">            try_files $uri $uri</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">index.html;</span></span>
<span class="line"><span style="color:#E1E4E8;">            proxy_pass </span><span style="color:#B392F0;">http</span><span style="color:#E1E4E8;">:</span><span style="color:#6A737D;">//127.0.0.1:8082;</span></span>
<span class="line"><span style="color:#E1E4E8;">         }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    # pms</span></span>
<span class="line"><span style="color:#E1E4E8;">    server {</span></span>
<span class="line"><span style="color:#E1E4E8;">        listen       </span><span style="color:#79B8FF;">8081</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        location </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            try_files $uri $uri</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">index.html;</span></span>
<span class="line"><span style="color:#E1E4E8;">            root   </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">share</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">pms;</span></span>
<span class="line"><span style="color:#E1E4E8;">            index  index.html index.htm;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    # oms</span></span>
<span class="line"><span style="color:#E1E4E8;">    server {</span></span>
<span class="line"><span style="color:#E1E4E8;">        listen       </span><span style="color:#79B8FF;">8082</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        location </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            try_files $uri $uri</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">index.html;</span></span>
<span class="line"><span style="color:#E1E4E8;">            root   </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">share</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">oms;</span></span>
<span class="line"><span style="color:#E1E4E8;">            index  index.html index.htm;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">http{</span></span>
<span class="line"><span style="color:#24292E;">    # main</span></span>
<span class="line"><span style="color:#24292E;">    server {</span></span>
<span class="line"><span style="color:#24292E;">        listen       </span><span style="color:#005CC5;">80</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        location </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            try_files $uri $uri</span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">index.html;</span></span>
<span class="line"><span style="color:#24292E;">            root   </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">usr</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">share</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">nginx</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">main;</span></span>
<span class="line"><span style="color:#24292E;">            index  index.html index.htm;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        location </span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">module</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">pms {</span></span>
<span class="line"><span style="color:#24292E;">           try_files $uri $uri</span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">index.html;</span></span>
<span class="line"><span style="color:#24292E;">           proxy_pass </span><span style="color:#6F42C1;">http</span><span style="color:#24292E;">:</span><span style="color:#6A737D;">//127.0.0.1:8081;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        location </span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">module</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">oms {</span></span>
<span class="line"><span style="color:#24292E;">            try_files $uri $uri</span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">index.html;</span></span>
<span class="line"><span style="color:#24292E;">            proxy_pass </span><span style="color:#6F42C1;">http</span><span style="color:#24292E;">:</span><span style="color:#6A737D;">//127.0.0.1:8082;</span></span>
<span class="line"><span style="color:#24292E;">         }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    # pms</span></span>
<span class="line"><span style="color:#24292E;">    server {</span></span>
<span class="line"><span style="color:#24292E;">        listen       </span><span style="color:#005CC5;">8081</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        location </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            try_files $uri $uri</span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">index.html;</span></span>
<span class="line"><span style="color:#24292E;">            root   </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">usr</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">share</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">nginx</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">pms;</span></span>
<span class="line"><span style="color:#24292E;">            index  index.html index.htm;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    # oms</span></span>
<span class="line"><span style="color:#24292E;">    server {</span></span>
<span class="line"><span style="color:#24292E;">        listen       </span><span style="color:#005CC5;">8082</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        location </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            try_files $uri $uri</span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">index.html;</span></span>
<span class="line"><span style="color:#24292E;">            root   </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">usr</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">share</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">nginx</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">oms;</span></span>
<span class="line"><span style="color:#24292E;">            index  index.html index.htm;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><ol start="2"><li>多个应用一个端口，子应用需要一个二级目录装着，子应用只配置一个location即可，但是目录名必须跟主应用的Layout路由的path属性一样，并且应用名必须跟是部署的目录一致，比如有主应用(main)，子应用有pms、oms，那么该目录结构如下：</li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;"> main</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;"> index.html</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">module</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;"> pms</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;"> index.html</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;"> oms</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;"> index.html</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--</span><span style="color:#24292E;"> main</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--</span><span style="color:#24292E;"> index.html</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">module</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--</span><span style="color:#24292E;"> pms</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--</span><span style="color:#24292E;"> index.html</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--</span><span style="color:#24292E;"> oms</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--</span><span style="color:#24292E;"> index.html</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>优点：一个端口即可，location只需两个，一个主应用，一个子应用</li><li>缺点：子应用都得在一个指定的目录下，打包后完需要用sh命令，改变dist目录名和位置，增加复杂度；对于部分运维部署软件，可能无法回滚；无法单独访问子应用</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">server {</span></span>
<span class="line"><span style="color:#E1E4E8;">    listen       </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    location </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> { # 主应用</span></span>
<span class="line"><span style="color:#E1E4E8;">        root   </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">data</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">qiankun</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">main;</span></span>
<span class="line"><span style="color:#E1E4E8;">        index index.html;</span></span>
<span class="line"><span style="color:#E1E4E8;">        try_files $uri $uri</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">index.html;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    # </span><span style="color:#F97583;">^~</span><span style="color:#E1E4E8;"> 匹配任何以</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">module</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">开头的任何查询并且停止搜索。任何正则表达式将不会被测试。</span></span>
<span class="line"><span style="color:#E1E4E8;">    # </span><span style="color:#F97583;">module</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">必须与</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">主应用的Layout路由的path</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">一直</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">location</span><span style="color:#E1E4E8;"> ^~ /</span><span style="color:#B392F0;">module</span><span style="color:#E1E4E8;">/ { # 所有子应用</span></span>
<span class="line"><span style="color:#E1E4E8;">        alias </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">data</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">qiankun</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        try_files $uri $uri</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">index.html;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">server {</span></span>
<span class="line"><span style="color:#24292E;">    listen       </span><span style="color:#005CC5;">80</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    location </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> { # 主应用</span></span>
<span class="line"><span style="color:#24292E;">        root   </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">data</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">qiankun</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">main;</span></span>
<span class="line"><span style="color:#24292E;">        index index.html;</span></span>
<span class="line"><span style="color:#24292E;">        try_files $uri $uri</span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">index.html;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    # </span><span style="color:#D73A49;">^~</span><span style="color:#24292E;"> 匹配任何以</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">module</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">开头的任何查询并且停止搜索。任何正则表达式将不会被测试。</span></span>
<span class="line"><span style="color:#24292E;">    # </span><span style="color:#D73A49;">module</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">必须与</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">主应用的Layout路由的path</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">一直</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">location</span><span style="color:#24292E;"> ^~ /</span><span style="color:#6F42C1;">module</span><span style="color:#24292E;">/ { # 所有子应用</span></span>
<span class="line"><span style="color:#24292E;">        alias </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">data</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">qiankun</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">module</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        try_files $uri $uri</span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">index.html;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="3"><li>多个应用一个端口，通过正则表达式匹配后缀名，用alias或者rewrite重写请求，要求应用名必须跟是部署的目录一致，可以设置vue.config.js的outputDir属性，改变dist目录名。</li></ol><p>先分析请求规则</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">请求 </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">module</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 主应用的启动页</span></span>
<span class="line"><span style="color:#E1E4E8;">请求 </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">module</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">pms</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">A</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// pms应用 A页面</span></span>
<span class="line"><span style="color:#E1E4E8;">请求 </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">module</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">pms</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">B</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// pms应用 B页面</span></span>
<span class="line"><span style="color:#E1E4E8;">请求 </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">module</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">oms</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">C</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// oms应用 C页面</span></span>
<span class="line"><span style="color:#E1E4E8;">请求 </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">module</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">oms</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">D</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// oms应用 D页面</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">请求 </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/module/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 主应用的启动页</span></span>
<span class="line"><span style="color:#24292E;">请求 </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">module</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">pms</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">A</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// pms应用 A页面</span></span>
<span class="line"><span style="color:#24292E;">请求 </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">module</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">pms</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">B</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// pms应用 B页面</span></span>
<span class="line"><span style="color:#24292E;">请求 </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">module</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">oms</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">C</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// oms应用 C页面</span></span>
<span class="line"><span style="color:#24292E;">请求 </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">module</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">oms</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">D</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// oms应用 D页面</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>根据如上规则，可以知道第一个/后面的module是固定的，第二个/后面就是应用名，第三个/后面是具体的路由地址。所以根据如上规则可以用正则表达式匹配，并改写请求。</p><ul><li>优点：一个端口，location只需两个，一个主应用，一个子应用；子应用的location用正则表达式动态匹配，并用rewrite动态重写url；在服务器打包完后的路径就是最终路径，不用改写目录。</li><li>缺点：Nginx的location正则匹配性能消耗性能大一点？</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">server {</span></span>
<span class="line"><span style="color:#E1E4E8;">    listen       </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    location </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> { # 主应用</span></span>
<span class="line"><span style="color:#E1E4E8;">        root   </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">data</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">qiankun</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">main;</span></span>
<span class="line"><span style="color:#E1E4E8;">        index index.html;</span></span>
<span class="line"><span style="color:#E1E4E8;">        try_files $uri $uri</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">index.html;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    location </span><span style="color:#F97583;">^~</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">module</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">(.</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">) { # 所有子应用</span></span>
<span class="line"><span style="color:#E1E4E8;">        try_files $uri $uri</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">index.html;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> ($1 </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">) { # 有值时，则跳到对应的子应用</span></span>
<span class="line"><span style="color:#E1E4E8;">            alias </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">data</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">qiankun</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$1</span></span>
<span class="line"><span style="color:#E1E4E8;">            # rewrite </span><span style="color:#9ECBFF;">&quot;/module/(.*)&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/data/web/qiankun/$1&quot;</span><span style="color:#E1E4E8;"> last;</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> { # 没有值时，则跳到主应用</span></span>
<span class="line"><span style="color:#E1E4E8;">            alias </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">data</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">qiankun</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">main</span></span>
<span class="line"><span style="color:#E1E4E8;">            #rewrite </span><span style="color:#9ECBFF;">&quot;/module/(.*)&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/data/web/qiankun/main&quot;</span><span style="color:#E1E4E8;"> last;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">server {</span></span>
<span class="line"><span style="color:#24292E;">    listen       </span><span style="color:#005CC5;">80</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    location </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> { # 主应用</span></span>
<span class="line"><span style="color:#24292E;">        root   </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">data</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">qiankun</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">main;</span></span>
<span class="line"><span style="color:#24292E;">        index index.html;</span></span>
<span class="line"><span style="color:#24292E;">        try_files $uri $uri</span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">index.html;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    location </span><span style="color:#D73A49;">^~</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/module/</span><span style="color:#24292E;">(.</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">) { # 所有子应用</span></span>
<span class="line"><span style="color:#24292E;">        try_files $uri $uri</span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">index.html;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> ($1 </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">) { # 有值时，则跳到对应的子应用</span></span>
<span class="line"><span style="color:#24292E;">            alias </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">data</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">qiankun</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">$1</span></span>
<span class="line"><span style="color:#24292E;">            # rewrite </span><span style="color:#032F62;">&quot;/module/(.*)&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/data/web/qiankun/$1&quot;</span><span style="color:#24292E;"> last;</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> { # 没有值时，则跳到主应用</span></span>
<span class="line"><span style="color:#24292E;">            alias </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">data</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">qiankun</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">main</span></span>
<span class="line"><span style="color:#24292E;">            #rewrite </span><span style="color:#032F62;">&quot;/module/(.*)&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/data/web/qiankun/main&quot;</span><span style="color:#24292E;"> last;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div>`,15),e=[o];function r(c,t,E,y,i,u){return n(),a("div",null,e)}const d=s(p,[["render",r]]);export{b as __pageData,d as default};
